"use strict";var CPayV3=(()=>{var d=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var b=(i,t)=>{for(var e in t)d(i,e,{get:t[e],enumerable:!0})},I=(i,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of v(t))!x.call(i,r)&&r!==e&&d(i,r,{get:()=>t[r],enumerable:!(o=y(t,r))||o.enumerable});return i};var k=i=>I(d({},"__esModule",{value:!0}),i);var T={};b(T,{button:()=>S});var l=class{getApiBaseUrl(){return"http://api.cryptumpay.local"}},h=new l;var s=class{name;constructor(t){this.name=t}key(t){return`${this.name}:${t}`}};var n=class extends s{items={};set(t,e){this.items[t]=e}get(t){return this.items[t]||null}remove(t){delete this.items[t]}};var g=class{auth;constructor(){this.auth=new n("auth")}setAccessToken(t){this.auth.set("jwtAccessToken",t)}getAccessToken(){return this.auth.get("jwtAccessToken")}forgetSensitiveData(){this.auth.remove("jwtAccessToken")}},f=new g;var p=class{config;store;logged=!1;isInitialization=!1;isReady=!1;onReady;constructor(t,e){this.config=t,this.store=e,this.onReady=[]}get isLogged(){return this.logged}async ready(){if(this.isReady)return;let t=new Promise(e=>{this.onReady.push(e)});return this.isInitialization||(this.isInitialization=!0,this.init()),t}setReady(){this.isReady=!0,this.isInitialization=!1;for(let t of this.onReady)t()}async init(){await this.refreshToken(),await this.setReady()}async refreshToken(){let t=`${this.config.getApiBaseUrl()}/user/refresh-token`;return new Promise(e=>{fetch(t,{method:"POST",credentials:"include"}).then(o=>o.json()).then(o=>{this.logged=!0,this.store.setAccessToken(o.accessToken),e()}).catch(o=>{console.warn(o),e()})})}async logout(){let t=`${this.config.getApiBaseUrl()}/user/logout`;return new Promise(e=>{fetch(t,{method:"POST",credentials:"include"}).then(o=>o.json()).then(o=>{this.logged=!1,this.store.forgetSensitiveData(),e(!0)}).catch(o=>{console.warn(o),e(!1)})})}},m=new p(h,f);var a=class{findElement(t){let e=document.getElementById(t);if(e)return e;throw new Error(`Unknown element ${t}.`)}};var c=class extends a{async create(t){let e=this.findElement(t);await m.ready(),m.isLogged&&console.warn("logged"),this.createNew(e)}createNew(t){let e=document.createElement("div");e.id="widget";let o=document.createElement("div");o.id="widget_pay",o.className="wide",o.textContent="Pay with CryptumPay",e.appendChild(o),t.appendChild(e)}};var u="#widget{width:300px;margin:20px;border:1px solid #aeaeae;border-radius:6px;display:flex;align-items:center;box-sizing:border-box;align-items:stretch}#widget_pay{flex-grow:1;display:flex;align-items:center;justify-content:center;font-size:15px;font-family:Verdana,Geneva,Tahoma,sans-serif;background:#61c3ff;color:#fff;cursor:pointer}#widget_pay.wide{padding:15px 0}#widget_pay:hover{background:#38b3ff}#widget_settings{display:flex;flex-direction:column;text-align:center;max-width:50%;background:#ade0ff;color:#6f6f6f;text-align:right}#widget_wallet{cursor:pointer;text-align:right}#widget_wallet:hover{background:#98d7ff}#widget_settings>div{padding:3px 20px}";var w=()=>{let i=document.createElement("style");i.textContent=u,document.head.appendChild(i)};w();var S=async i=>{await new c().create(i)};return k(T);})();
